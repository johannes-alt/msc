\chapter{One Cell Prototype}

In this chapter the different parts of the one cell prototye are presented.
Starting at the steel cell filled with liquid scintillator over the \acp{wom} and \acp{sipm} used for the collection and detection of the scintillation light to the amplifier and digitizer.



\section{Cell \& LAB}

abmessungen

emissionsspektrum

\section{Wavelengthshifting optical Module \& optical coupling}

emissions spektrum


\section{Silicon Photomultiplier}
In order to correctly identify and tag background events, the light detection of the \ac{sbt} has to provide accurate timing information.
Therefore \acp{sipm} were chosen as photodetectors.
These photodetectors consist of up to thousands of pixels.
Each pixel is a photodiode with a typical edge length between \SI{10}{\micro\meter} and \SI{100}{\micro\meter} \cite{nucl}.
If triggered by light, a \ac{sipm} sends out a charge signal proportional to the incoming light.
This charge possesses a fast-rising edge with a rise time of the order of tens of \si{\piko\second} \cite{nucl}.
Besides the good time resolution, \acp{sipm} also make it possible to count the arriving photos with a sensitivity down to single photons \cite{HAMA_mppc}.


Similar to every photodiode, \acp{apd} utilize the photoelectric effect, to generate an electric charge signal in response to a light signal.
This is made possible by using silicon as a base material and introducing impurities. 
This process is called doping and there are two different possibilities for doping. 
In the n-doping, the impurities are atoms with five valence electrons.
Four of these electrons are part of boundings with silicon atoms, and the fifth electron is only weakly bound.
When p-doping, atoms with only three valence electrons are inserted into the silicon.
This leads to missing charges in the silicon, called holes.
By having an n-doped and a p-doped region in the silicon, the excess electrons from the n-doped region combine with the holes from the p-doped region, resulting in a depleted region at the pn-junction.
If a photon hits the photodiode, it can create an electron-hole pair, or $eh$-pair.
The electron and the hole get split by the electric field and thus create a charge signal.
In order to increase the sensitivity of the photodiode, an intrinsic layer can be added in between the two doped regions, thus increasing the depletion layer and therefore the photosensitive area.
Such a photodiode is called a pin-diode.
An \ac{apd} with a weakly doped $\pi$ intrinsic layer and strongly doped $p^+$ and $n^+$ layers is shown in \autoref{fig:pin_diode}.
This intrinsic layer can either be not doped at all or weakly doped.
In the case of \acp{apd} the intrinsic layer is weakly doped. 
In order to amplify the signal, a strong doped region is inserted, thus creating a multiplication zone.
\begin{figure}
	\centering
	\includegraphics[width=1.\textwidth]{pictures/pin_diode}
	\caption[Illustration of a APD.]{Composition of a avalanche photo diode with the bias voltage $V_\text{B}$ applied in reverse direction. Between the contact to ground and the strongly doped $n^+$ layer is the quenching resistor $R_\text{q}$ connected in series. Next to the $n^+$ layer is a strongly doped $p^+$ layer. In the region of these two layers is the electric field, shown on the right figure, the strongest. There a electron or hole can initiate an avalanche. After the $p^+$ layer comes a intrinsic weakly doped $\pi$ layer. This layer increases the sensitive volume of the diode. If a electron-hole pair is created and seperated by the electric field. The hole drifts towards the multiplication region and can start an avalanche. The next layer is a $p^+$ layer which connects to a metal connector and high voltage. \cite{kemp}}
	\label{fig:pin_diode}
\end{figure}

When a reverse bias voltage is applied to the \ac{apd}, the electric field between the $n^+$ and $p^+$ layers is strong enough that a created $eh$-pair creates more $eh$-pairs, resulting in an avalanche.
For this avalanche process to be possible the reverse bias voltage must be at or above the breakdown voltage of the \ac{apd}.
With such a bias voltage applied, the \ac{apd} operates in the Geiger mode and the avalanche is then self-sustaining.
This results in a macroscopic signal and makes the detection of single photons possible.
Therefore these diodes are also called \ac{spad}.
To stop the avalanche, a quenching resistor is connected in series with the \ac{spad}.
With an increasing current signal flowing through the quenching resistor, the voltage drop at this resistor increases, and thus the bias voltage at the \ac{spad} decreases.
When the bias voltage drops under the breakdown voltage, the avalanche is no longer self-sustaining and stops.
Thus the signal amplitude of a \ac{spad} is always similar, independent of how many photons arrive at the same moment.
In \acp{sipm} hundreds to thousand \acp{spad} are connected in parallel, each with a high resistance quenching resistor in series. 
Usually, the \ac{spad} pixels are placed in a rectangular form with an edge length of a few \si{\milli\meter}.
\autoref{fig:sipm_closeup} shows a picture of a \ac{sipm} and one picture of a single pixel of a \ac{sipm}.
Due to the property of the \acp{spad} that the output signal is always similar for each \ac{spad}, the output signal of a \ac{sipm} is the output signal of one \ac{spad} multiplicated with the number of triggered \acp{spad}.
Therefore, if the number of photons arriving simultaneously at a \ac{sipm} is low enough, that the probability of one \ac{spad} being hit by two or more photons is low, one can count photons with a \ac{sipm}.
This and the relatively low cost, high durability, and impassivity to magnetic fields make them a good option for photodetection for the \ac{sbt} and similar detectors.

In the following different properties of \acp{sipm} are presented, beginning with the signal shape of a single \ac{spad} and of a \ac{sipm}.


\paragraph{The signal shape} of a \acp{spad} starts with a fast exponential rise with the time constant 
\begin{align}
	\tau_\text{rise}&=R_\text{S}\cdot C_\text{d}
\end{align}
with the resistance $R_\text{rise}$ and capacitance $C_\text{d}$ of the \ac{spad} \cite{HAMA_mppc}.
After the signal reached its maximum current at around 
\begin{align}
	I_\text{max}&\approx \frac{V_\text{ov}}{R_\text{q}}
\end{align}
the quenching and recharging of the \ac{spad} starts.
Thus the current signal decreases again exponentially.
The time constant for the signal decay
\begin{align}
	\tau_\text{decay} &= R_\text{q}\cdot C_\text{d}
\end{align}
depends on the capacitance $C_\text{d}$ of the \ac{spad} and the quenching resistor $R_\text{q}$ \cite{HAMA_mppc}.
This signal develpment is shown in \autoref{fig:spad_signal_shape}.
\begin{figure}
	\centering
	\includegraphics[width=0.75\textwidth]{pictures/spad_signal_shape}
	\caption[SPAD signal shape]{Single photon avalanche diode signal shape. The exponential rise with the time constant $R_\text{S}\cdot C_\text{d}$ is followed by the exponential decay with the time constants $R_\text{q}\cdot C_\text{d}$. The maximum of the current signal is at approximately $V_\text{ov}/R_\text{q}$ \cite{HAMA_mppc}}
	\label{fig:spad_signal_shape}
\end{figure}

When multiple \acp{spad} in a \ac{sipm} are triggered, the output signal will be the summation of the signals from all triggered \acp{spad}.
Besides the number of triggered \acp{spad}, the time difference between the signals from the single \acp{spad} influences the signal.
In the case, that all \acp{spad} are triggered at the same time, the \ac{sipm} signal will have the shape of a \ac{spad} signal scaled up by the factor of the number of triggered \acp{spad}.
If the signals form the individual \acp{spad} have a small difference in time, the \ac{sipm} signal will become broader.




\paragraph{The gain} $G$ of a \ac{sipm} describes the number of charge carriers released in each avalanche.
Due to the quenching, this parameter is well defined \cite{}.
It can be calculated from the applied voltage $U_\text{bias}$, the breakdown voltage $U_\text{bd}$ and the capacitance $C_\text{d}$ of a \ac{spad} with
\begin{align}
	G &= \frac{(V_\text{bias}- V_\text{bd})\cdot C_\text{d}}{\text{e}}.
\end{align}
Here e represents the charge of one electron.
Usually the gain is in the order of $10^5$ to $10^7$ \cite{nucl}.

\paragraph{The noise} in \acp{sipm} can be sorted into two categories.
The first is primary noise, it describes the triggering of avalanches by thermaly created $eh$-pairs and not by incident photons.
Because the rate of theses thermaly caused events increases and decreases with the temperature, by controling the temperatur one can influence and decrease the rate of primary noise events.
The second category is the correlated noise.
It includes all events triggered by a primary event.
This correlated noise does have two causes.
One cause is the trapping and releasing of charge carriers from the avalanche. 
When the time between the trapping and releasing is long enough, the avalanche of the primary event stoped and the released carrier can trigger another avalanche.



\subsection{Photoelectron spectrum}


After the theory and important properties of \acp{sipm} are now introduced, the next chapter will present the measurement setup and data acquisition used for this thesis.

\section{The \ac{emusic} Board}
Since the signals of the \acp{sipm} are very small, a single photolectron signal has an amplitude of around \SI{2.5}{\milli\volt}, they need to be amplified.
For this purpous the \ac{emusic} \ac{asic} by Scientifica was chosen and a custom \ac{pcb} housing the \ac{emusic} \ac{asic}, from here on called \ac{emusic} board, was designed by the electrical engineers of the University of Freiburg.
In the following first the \ac{asic} itself and afterwards the \ac{emusic} board will be presented.

\paragraph{The \ac{emusic} \ac{asic}} was developed by Scientifica for the readout of \acp{sipm}.
It is mainly an amplifier and a shaper, but also offers other options like digital trigger signals if the signal crosses an adjustable threshold.
The \ac{asic}\'s block diagram is shown in \autoref{fig:emusic_block_diagram}.
\begin{figure}
	\centering
	\includegraphics[widht=0.7\textwidht]{pictures/emusic_block_diagram.png}
	\label{fig:emusic_block_diagram}
	\caption[eMUSIC block diagram]{The block diagram of the \ac{emusic} \ac{asic}. }
\end{figure}
It has eight input channels each equiped with a $\approx\SI{1}{\volt}$ anode voltage control to equalize the applied overvoltage between the different channels.
Because the \acp{sipm} deliver a charge signal, each channel has a current mode input stage.
The \ac{emusic} \ac{asic} was designed to have a low input transimpedance, but provides the option of a high transimpedance mode with which the gain can be increased.
Each individual channel has bandwith of \SI{150}{\mega\hertz} and a pole-zero cancellation, schematics shown in \autoref{fig:emusic_pole_zero}, with two adjustable resistors and a adjustable capacitor.
It can be used to decrease the \ac{fwhm} of the output signal to below $\SI{10}{\nano\second}$.
But a smaller width also attenuates the amplitude of the signal.
The resistor has eight possible values it can be set to and the capacitor has thirty-two different steps.
Although the \ac{emusic} provides the option of a lower attenuation mode of the pole-zero cancellation, a compromis between smaller signal width and higher amplitude should be chosen depending on ones needs.
Alteratively the pole-zero cancellation can be disabled completely, resulting in the highest signal amplitude possible with the \ac{emusic} but also in the longest signal.
The signal after the shaper can be put out with an analoge output for each channel.
\begin{figure}
	\centering
	\includegraphics[width=0.5\textwidth]{pictures/emusic_pole_zero.png}
	\label{fig:emusic_pole_zero}
	\caption[eMUSIC pole-zero cancellation]{Sketch of a pole-zero cancellation with adjustable resistors and capacitor.}
\end{figure}

Each channel also posseses a discriminator with an adjustable threshold to create a channel by channel trigger signal.
These logical signals can be either put out by using the individual output of the channel for the digital signal instead for the analog waveform or by using the fast OR of all channels.
This fast OR allows for example the external triggering of the digitzer which than digizes the analog waveforms if the waveform of one or more channels surpasses the threshold.
The dynamic range of the output for the single edge signals is \SI{1}{\volt} if the load on the output is \SI{50}{\ohm} and \SI{2}{\volt} if a high impedance load is used on the ouput.
Using the low transimpedance mode, the gain of the single edge output is \SI{180}{\ohm} and with the high transimpedance mode it is \SI{480}{\ohm}.
Over the first half of the dynamic range the response of the \ac{emusic} is linear and over the second half it is non-linear.

Besides the individual readout of the eight channels the \ac{emusic} can sum up the signal of an arbitrary set of channels with both high and low gain and put them out via two differential outputs.
The bandwith of this summation output is \SI{500}{\mega\hertz} and the output range is \SI{1.25}{\volt}.
Depending on wether the high or low transimpedance is used, the gain of the high gain summation is \SI{690}{\ohm} or \SI{90}{\ohm} and \SI{315}{\ohm} or \SI{45}{\ohm} for the low gain summation. 
The response of the summation output is linear over the dynamic range.

Besides choosing the channels for summation, also each of the eight single edge outputs can be individually turned on and off.
Another important option that can be configered is the adjustment of the output DC offset to maximize the rail-to-rail voltage swing.

\paragraphe{The trigger threshold} for the digital outputs can be set with two parameters.
The bandgap voltage $V_\text{bg}$ of the comparators, which can be adjsuted in eight steps, to one of the following values:
\begin{align}
	V_\text{bg}&=\SIlist{487.22;730.92;974.62;1218.3;1462.0;1705.7;1949.4;2436.8}{\milli\volt}
\end{align}
The second parameter sets the \ac{dac} value $N_\text{DAC}$ for the comparators.
It can be set to \ac{dac} counts from 0 to 511.
The finer threshold steps $V_\text{fine}$ can be calculated with
\begin{align}
	V_\text{fine}&=\SI{1637.79}{\milli\volt} - N_\text{DAC}\cdot\SI{3.1445}{\milli\volt}.
\end{align}
With $V_\text{bg}$ and  of $V_\text{fine}$ or $N_\text{DAC}$ the final threshold
\begin{align}
	V_\text{th}&= 1.5\cdot V_\text{bg} - 0.5\cdot V_\text{fine}\\
		   &= 1.5\cdot V_\text{bg} - 0.5\cdot (\SI{1637.79}{\milli\volt} - N_\text{DAC}\cdot\SI{3.1445}{\milli\volt})
\end{align}
can be calculated.

\paragraph{The \ac{emusic} board} was designed at the University of Freiburg.
A graphic of the board is shown in \autoref{fig:emusic_board}.
It's heart is the \ac{emusic} \ac{asic} (U1).
In order to program the \ac{asic} the ATmega328P-AU microchip (U4) is placed on the board.
The microchip can be programed with the XXXX software by XXXXX and the XXXXX which is connected to the computer via USB and can be pluged into the J4 connector on the \ac{emusic} board.
After programing the microchip it only has to be programed again if the reset button SW1 is pressed.
Then the \ac{emusic} \ac{asic} can be configered by using a TTL-to-USB adapter connected to a computer and the P3 connector and the software of the minimusic board.
The minimusic board is a comercial product using the \ac{emusic} \ac{asic}.
Due to the \ac{emusic} board being designed to work with the minimusic software, one avoids the need to create a software and also has the security, that the used software was tested and is working properly.
Two functions of the minimusic software are not usable on the \ac{emusic} board, the calibration of the threshold and the calibration of the DC offset on the outputs.
Therefore theses two need to be set by the user.

The high voltage for the \acp{sipm} can be supplied via the P2 SMA connector.
On the backside of the \ac{pcb} is a LSHM-150-XX.-XXX-DV-AN-XX connector located to connect the board to the \ac{sipm} board.
Via this connector the high voltage is brought to the \acp{sipm} and the signals are brought to the \ac{emusic} inputs.
The eight single ended outputs can be read out by the SMA connectors K1 to K8.
The fast OR signal can be read out via the K9 connector.
Both the high and low gain differential summation outputs are connected to the pins of the J6 connector.

The board also provides the possibility via the P1 connector to power the six LEDs soldered onto the \ac{sipm} boards.
But the usage of this is not advised, since this will introduce interferences into the signals.


\begin{figure}
	\centering
	\includegraphics[width=.5\textwidth]{pictures/emusic_board.png}
	\caption[eMUSIC Board]{Picture of the \ac{emusic} board with the \ac{emusic} \ac{asic}, the eight single ended channel by channel SMA signal outputs, the SMA fast OR output, the differential signal output, the SMA connector for the high voltage supply of the \acp{sipm} and the connectors to program and power the board.}
	\label{fig:emusic_board}
\end{figure}





\section{The Gandalf Framework}
The amplified and shaped output signal of the \ac{emusic} \ac{asic} needs to be digitized.
This step is done by Gandalf modules.
Originally developed at the University of Freiburg for the \ac{compass} experiment it has a modular design to fill different roles in the experiments \ac{daq}.
Using mezzanin cards different signal, clock and trigger inputs can be chosen.
In the following the Gandalf framework will be introduced.
The mezzanin cards not used in this work are therefore only mentioned but not presented in detail.
A overview of a Gandalf module is shown in \autoref{fig:gandalf_overview}.
\begin{figure}
	\centering
	\includegraphics[width=1.\linewidth]{pictures/gandalf_overview.png}
	\label{fig:gandalf_overview}
	\caption{Overview of the Gandalf module equiped with Analog Mezzanin Cards (AMCs) and the fiber Gimli mezzanin card for clock an trigger input. The analog waveforms are digitized by the AMCs and the digitized data is processed by the DSP FPGA. The MEM FPGA handles the memory of the processed data, which can be transfered to a computer via the USB inteface on the front of the VME or S-Link interfaces on the backplane. \cite{herrmann}}
\end{figure}

\subsection{Input Mezzanin Cards}
The Gandalf module has two mezzanin card slots for input signals.
For these slots three different mezzanine cards were developed, \ac{amc}, \ac{dmc} and \ac{omc}.
First the latter two mezzanine cards are shortly presented for completeness but are not relevant for the work done in this thesis.

\paragraph{The \ac{dmc}} has 64 digital inputs. 
A picture of it is shown in \autoref{fig:dmc}.
Using either the LVDS or the LVPECL signal standard, one can use the DSP-\ac{fpga} logic for tasks like trigger decisions, time-to-digital conversion or pattern generators, to name a few.
By changing the direction of the input buffer on the \ac{dmc} \ac{pcb}, the 64 channels of the \ac{dmc} can be used as outputs intead of inputs.

\paragraph{The \ac{omc}} has four \SI{3.25}{\giga\bit\per\second} transceivers to receive digital informations, which can be further processed by the DSP-\ac{fpga}.
With this mezzanine card, the GANDALF can be used for example to merge data or as a concentrator.
A picture of a \ac{omc} is shown in \autoref{fig:omc}.

\paragraph{The \ac{amc}} is designed to digitize analog input signals.
For the digitization, eight \ac{adc} are used.
There are \ac{amc} with two different \ac{adc} available.
One is the \textit{ADS5463} with \SI{12}{\bit} and up to \SI{500}{\mega\sample\per\second} and the other is the \textit{ADS5474} which samples with up to \SI{400}{\mega\sample\per\second} at \SI{14}{\bit}.
The \ac{enob} of both \acp{adc} are \SI{10.4}{\bit} and \SI{11.2}{\bit} respectively.
Each \ac{amc} has eight SMC connectors for the inputs.
There are \ac{amc} operating in \textit{normal mode}, meaning each SMC connector is connected to one \ac{adc}, resulting in eight channels with up to \SI{500}{\mega\sample\per\second} or \SI{400}{\mega\sample\per\second} per \ac{amc}.
In order to increase the sample frequency, \ac{amc} which operate in the \textit{interleaved mode} were build.
On these \acp{amc} four inputs are connected to two \ac{adc}s each and therefore every second SMC connector is a dead end.
The clock signals which provide the sample tact for the two \acp{adc} of one channel have \SI{180}{\degree} phase offset in respect to each other.
By this the sample frequency is doubled to up to \SI{1}{\giga\sample\per\second} or \SI{800}{\mega\sample\per\second}, but the number of channels per \ac{amc} is reduced from eight to four.
The dynamic input range of the \ac{amc} is \SI{4.4}{\vpp} and can be shifted from the negative unipolar range \SIrange{-4.4}{0}{\volt} up to the bipolar range \SIrange{-2.2}{2.2}{\volt}.
This shifting is done by a \textit{AD5665R}, a \SI{16}{\bit} \ac{dac}.
The dynamic range was chosen because in the COMPASS experiment, for which the GANDALF was developed, negative voltage pulses created by \acp{pmt} needed to be digitized.
But because the used \acp{adc} expect positive differential signals, inverting operational amplifiers are used to change the polariy of the signal.
By changing the gain of the amplifiers one can decrease the input range and therefore increase the amplitude resolution.
The \acp{amc} used in this thesis are \SI{12}{\bit} \acp{amc} in the \textit{interleaved mode} and a dynamic range of \SI{2.2}{\vpp}.


\subsection{GIMLI Mezzanine Cards}
The third mezzanine card slot is for the GIMLI mezzanine cards, which are responsible for the clock and external trigger signals.
For this mezzanine card, three different options were developed.
One GIMLI card, which takes the clock and trigger from the backplane, if one wants to use the create to distribute the signals.
The fiber GIMLI, which has one fiber input to reseive the clock and trigger via optical fiber.
And the copper GIMLI, which was used for this work and is presented in the following.

The copper GIMLI, shown in \autoref{fig:copper_gimli}, provids the option to use an external or an internal clock.
If only one GANDALF module is used the internal \SI{20}{\mega\hertz} clock of the copper GIMLI can be used.
It is provieded by a on board oven controlled oscillator (OCXO) with a jitter less than \SI{2.3}{\pico\second}.
In case two or more GANDALFs are used an external clock is required to ensure a synchronized clock on all GANDALF modules.
For this case, the copper GIMLI has a LEMO connector as input for an external clock with \ac{nim} signal standard.
Via a second LEMO connector an external \ac{nim} trigger signal can be connected to the GANDALF module.

\begin{figure}
	\centering
	\includegraphics[width=.5\textwidth]{pictures/copper_gimli.png}
	\caption[Copper GIMLI]{Picture of the copper GIMLI with an internal \SI{20}{\mega\hertz} clock generated by an on board oven controlled oscillator. With the LEMO connectors external clock and trigger \ac{nim} signals can be provided for the GANDALF.}
	\label{fig:copper_gimli}
\end{figure}



\subsection{Usage of the GANDALF with \acp{sipm}}
In this work, the GANDALF was used to digitize the ouput signal of the \ac{emusic} \ac{asci}.
As mentioned in above in \autoref{sec:emusic} theses signals have a positive polarity.
But because the GANDALF was designed for the digitization and processing of negative voltage pulses created by a \ac{pmt}, this caused some problems.
Since after the inverting operational amplifiers in the GANDALF the \ac{sipm} signals have a negative polarity, the input voltage range needs to be chosen to be bipolar and around \SIrange{-1.1}{1.1}{\volt}.
In order to get this input range the baseline at \SI{0}{\volt} would need to be set to \SI{2047}{\adcu}.
For unknown reasons the programm which configeres the \acp{dac} to set the baseline to a \si{\adcu} value selectable by the user will set the baseline to a maximum of around \SI{1400}{\adcu}.
With $\frac{2.2}{2^12}\,\si{\volt\per\adcu} = \SI{0.537}{\milli\volt\per\adcu}$ the range of the inverted signal is \SI{1400}{\adcu} which corresponds to approximately \SI{752}{\milli\volt}.
Should this range be not enough, one needs to either try to find the source of the problem and fix it or decrease the amplification of the \ac{emusic} \ac{asic}.

The next problem regards the self-trigger of the GANDALF.
It functions via samples-over-threshold, the user can set a threshold and a number of consecutive samples which need to be over the threshold for the GANDALF to trigger an event.
Since after the inverting of the positive signals the signals have a negative polarity, the threshold needs to be set to a lower \si{\adcu} value than the baseline.
In addition to that the sample-over-threshold condition in the GANDALF firmware needed to be inverted to trigger if a number of consecutive samples are below the threshold.
The new firemware with the inverted trigger condition was tested and works as intended with the exception of one bug.
If the data rate from the GANDALF to the \ac{daq} computer exceeds the maximum possible data rate, \SI{20}{\mega\byte\per\second} in case of the USB inteface, incomplete events will be written down to disk.
This is most likely caused by a missing VHDL file that was not included in the new firmware and which would, incase the buffer of the GANDALF is completly filled, prevent the GANDALF to send incomplete events to the computer.
For the intended use of this bug should not be a problem, since the data rate is expected to be way below the possible \SI{20}{\mega\byte\per\second}.
